shared_buildings_refinery:
	Inherits: ^CoreBuilding
	Tooltip:
		Name: Refinery
	Health:
		HP: 800
	Power:
		Amount: -300
	FreeActor:
		# TODO: support changing actor based on presence of Air Base and researched Flying technology
		Actor: shared_vehicles_bantha
		# Actor: shared_aircrafts_heavy_lifter
		SpawnOffset: 2,1
		Facing: 512
		RequiresCondition: !Transforming
	ResourceRefinery:
		InsideOffset: 1384,-512,0
		EntryOffset: 1216
		OutsideOffset: 512,-512,0
		ZOffset: 588
		RequiresCondition: !Transforming
		PauseOnCondition: !Powered

	AircraftConveyorBeltDock@HeavyLifter:
		RequiresCondition: !Transforming

		# DockHost
		Type: AircraftUnload
		IsDragRequired: false
		DockWait: 1
		
		DockOffset: 1384,-512,0
		AllowedDockAngles: 0, 128, 256, 384, 512, 640, 768, 896

	ConveyorBeltDock@PortSouth:
		RequiresCondition: !Transforming

		# DockHost
		Type: Unload
		IsDragRequired: true
		DockWait: 1
		
		# South side
		DockOffset: 1414,590,0
		DockAngle: 512
		DragOffset: 1404,185,0
		DragLength: 20
	
	ConveyorBeltDock@PortNorth:
		RequiresCondition: !Transforming

		# DockHost
		Type: Unload
		IsDragRequired: true
		DockWait: 1
		
		# North side
		DockOffset: 1024,-1024,0
		DockAngle: 0
		DragOffset: 1404,-913,0
		DragLength: 26
		
	ConveyorBeltDock@PortEast:
		RequiresCondition: !Transforming

		# Sequences for crate movement during (un)load animation
		LoadSequence:
			Delays: 0, 3, 5, 2, 2
			Offsets: 400, 250, 150, 20, 0
		UnloadSequence:
			Delays: 0, 2, 2, 5, 3
			Offsets: 0, 20, 150, 250, 400

		# DockHost
		Type: Unload
		IsDragRequired: true
		DockWait: 1
		
		# East side
		DockOffset: 2438,-434,0
		DockAngle: 768
		DragOffset: 2238,-434,0
		DragLength: 20
	
	WithIdleOverlay@Powered:
		Sequence: idle-lights
		RequiresCondition: Powered
	WithIdleOverlay@Belt:
		Sequence: belt
		Offset: 208,1644,0
		RequiresCondition: !Transforming
	WithIdleOverlay@BeltRetract:
		Sequence: belt-retract
		Offset: 424,1328,0
		RequiresCondition: !Transforming && BeltActive
		PauseOnCondition: !Powered
	WithIdleOverlay@Belt-light:
		Sequence: belt-lights
		Offset: 208,1644,0
		RequiresCondition: Powered
	WithNightLightSource:
		RequiresCondition: !Transforming && Powered
	Building:
		Dimensions: 3,3
		Footprint: xxx x== ===
		LocalCenterOffset: -390,-590,0
	BuildingCrew:
		MaxPopulation: 5
	TransformSequence:
		Offset: 360,540,0
	HitShape@1:
		TargetableOffsets: 848,-850,0,   848,-150,0,   848,550,0,   0,-850,0,   0,-150,0,   0,550,0
		Type: Rectangle
			TopLeft: -1124, -924
			BottomRight: 924, 412
	HitShape@2:
		TargetableOffsets: -1024,-750,0,   -1024,-300,0
		Type: Rectangle
			TopLeft: -1024, 412
			BottomRight: 0, 1024
	Selectable:
		Polygon: 394,132, 3492,132 , 3492,1119, 1544,1119, 1544,2076, 394,2076
		DecorationBounds: 3088, 1950, 384, 128
	ProvidesPrerequisite:
		RequiresCondition: !Transforming
	GrantConditionOnDamageState:
		Condition: damaged
	# TODO Smoke should only come out from chimey when resources are delivered inside Refinery.
	FloatingSpriteEmitter:
		Duration: -1
		Lifetime: 27
		SpawnFrequency: 5
		Speed: 5
		Gravity: 42
		RandomRate: 0
		Palette:
		Offset: -512,112,0
		Image: refinery_smoke
		Sequences: chimney_smoke
		RequiresCondition: !Transforming && Powered && !damaged && BeltActive
	FloatingSpriteEmitter@Damaged:
		Duration: -1
		Lifetime: 27
		SpawnFrequency: 5
		Speed: 5
		Gravity: 42
		RandomRate: 0
		Palette:
		Offset: -512,812,0
		Image: refinery_smoke
		Sequences: chimney_smoke
		RequiresCondition: !Transforming && Powered && damaged && BeltActive
	Encyclopedia:
		Category: Shared - Buildings
		Order: 3
		Animation: DATABASE/X03.FLC
		Title: Refinery
		Armor: Cannot be damaged by normal firearms.
		Armament: None
		Resistance: Medium
		Description: The refinery processes the raw materials excavated from the mines. The raw materials are then sold thereby improving the budget. Each container is filled with resources to the value of 200 Dollars.\n\nThe refinery is fully automated and does not require any personnel whatsoever.\n\nThe containers are brought to the refinery using either a BANTHA or HEAVY LIFTER. They load the containers onto a conveyer belt which transports the containers inside the refinery.

shared_mcu_refinery:
	Inherits@1: ^SharedVehicleMcu
	Tooltip:
		Name: Mobile Refinery
	Transforms:
		IntoActor: shared_buildings_refinery
	Valued:
		Cost: 1000
	Buildable:
		IconPalette:
		Queue: Building.UCS, Building.ED
		BuildDuration: 100
		BuildPaletteOrder: 50
		Prerequisites: anypower
	WithTextDecoration:
		Text: Refinery
